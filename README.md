# tgshop
Telegram shop for admin panel and pay

Telegram –ú–∞–≥–∞–∑–∏–Ω—á–∏–∫ —Å —à–∏—Ä–æ–∫–∏–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª–æ–º –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏
–î–æ—Å—Ç—É–ø–Ω—ã–µ –ø–ª–∞—Ç—ë–∂–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã: Yoomoney
–ò–∑ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–µ–π: —Ä–∞—Å—Å—ã–ª–∫–∞, –ø—Ä–æ—Ñ–∏–ª—å —é–∑–µ—Ä–∞
–ó–∞–ø–æ–ª–Ω–∏—Ç–µ settings.ini

sudo apt install python3 && python3-pip
pip3 aiogram==2.13 YooMoney
python3 main.py

–§—É–Ω–∫—Ü–∏–∏ :
"shop": "üõí –¢–æ–≤–∞—Ä—ã",
"profile": "üì± –ü—Ä–æ—Ñ–∏–ª—å",
"onas": "üìú –û –Ω–∞—Å",

"about_shop": "\uD83C\uDFEA –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –º–∞–≥–∞–∑–∏–Ω–æ–º",
"faq": "‚ÑπÔ∏è FAQ",
"rules": "üìó –ü—Ä–∞–≤–∏–ª–∞",
"hello_message": "\uD83D\uDC4B –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ",
"comeback_message": "‚úã –í–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ",

"support": "üë®‚Äçüíª –ü–æ–¥–¥–µ—Ä–∂–∫–∞",
"my_support": "\uD83D\uDCD3 –ú–æ–∏ –æ–±—Ä–∞—â–µ–Ω–∏—è",
"new_support": "\uD83D\uDCCB –ù–æ–≤–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ",
"active_support": "\uD83D\uDCD7 –ê–∫—Ç–∏–≤–Ω—ã–µ –æ–±—Ä–∞—â–µ–Ω–∏—è",
"close_support": "\uD83D\uDCD5 –ó–∞–∫—Ä—ã—Ç—ã–µ –æ–±—Ä–∞—â–µ–Ω–∏—è",
"cancel_support": "\uD83D\uDEAB –û—Ç–º–µ–Ω–∞ –∑–∞–ø—Ä–æ—Å–∞",

"accept_rules": "‚úÖ –û–∑–Ω–∞–∫–æ–º–ª–µ–Ω –∏ —Å–æ–≥–ª–∞—Å–µ–Ω",

"to_all_category": "‚¨Ö –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º",
"buy": "\uD83D\uDECD –ö—É–ø–∏—Ç—å",
"buy_item": "\uD83D\uDCB3 –û–ø–ª–∞—Ç–∏—Ç—å",
"check_buy": "\uD83D\uDD04 –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–ø–ª–∞—Ç—ã",
"cancel_buy": "\uD83D\uDEAB –û—Ç–º–µ–Ω–∞ –æ–ø–ª–∞—Ç—ã",

"items": "üì¶ –í—Å–µ —Ç–æ–≤–∞—Ä—ã –º–∞–≥–∞–∑–∏–Ω–∞",
"add_item": "üìì –î–æ–±–∞–≤–∏—Ç—å —Ç–æ–≤–∞—Ä",
"item_management": "üìù –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞–º–∏",
"edit_name": "üìô –ò–∑–º–µ–Ω–∏—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ",
"edit_desc": "üìã –ò–∑–º–µ–Ω–∏—Ç—å –æ–ø–∏—Å–∞–Ω–∏–µ",
"edit_pic": "\uD83D\uDCF7 –ò–∑–º–µ–Ω–∏—Ç—å –∫–∞—Ä—Ç–∏–Ω–∫—É",
"edit_price": "üíµ –ò–∑–º–µ–Ω–∏—Ç—å —Ü–µ–Ω—É",
"edit_data": "üì¶ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã–º–∏ —Ç–æ–≤–∞—Ä–∞",
"load_data": "\uD83D\uDCD3 –î–æ–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö",
"delete_data": "\uD83D\uDDD1 –£–¥–∞–ª–∏—Ç—å –æ—Å—Ç–∞—Ç–∫–∏",
"delete_item": "üóë –£–¥–∞–ª–∏—Ç—å —Ç–æ–≤–∞—Ä",

"category_management": "üìÅ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏",
"add_category": "üìÇ –î–æ–±–∞–≤–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é",
"add_subcategory": "üìÇ –î–æ–±–∞–≤–∏—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é",
"delete_category": "üóë –£–¥–∞–ª–∏—Ç—å –∫–∞—Ç–µ–≥–æ—Ä–∏—é",
"delete_subcategory": "üóë –£–¥–∞–ª–∏—Ç—å –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—é",

"users": "üôç‚Äç‚ôÇ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",
"find_user": "\uD83D\uDD0E –ù–∞–π—Ç–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è",

"statistic": "\uD83D\uDCCA –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞",
"general": "\uD83D\uDCCA –û–±—â–∞—è",
"daily": "\uD83D\uDCC6 –ï–∂–µ–¥–Ω–µ–≤–Ω–∞—è",
"all_users": "\uD83D\uDE4D\u200D‚ôÇ –í—Å–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏",
"all_purchases": "\uD83D\uDED2 –í—Å–µ –ø–æ–∫—É–ø–∫–∏",

"payment": "\uD83D\uDCB3 –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ–ø–ª–∞—Ç–æ–π",
"qiwi": "\uD83E\uDD5D QIWI",
"yoomoney": "\uD83D\uDCB5 YooMoney",
"edit_payment": "üìù –ò–∑–º–µ–Ω–∏—Ç—å –¥–∞–Ω–Ω—ã–µ",
"check_payment": "üîÅ –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ—à–µ–ª–µ–∫",
"mailing": "\uD83D\uDCE7 –†–∞—Å—Å—ã–ª–∫–∏",
"create_mailing": "\uD83D\uDCEE –°–æ–∑–¥–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É",

"edit": "\uD83D\uDCDD –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å",
"cancel": "–û—Ç–º–µ–Ω–∞",
"next": "–í–ø–µ—Ä–µ–¥ ‚û°",
"back": "‚¨Ö –ù–∞–∑–∞–¥",
"return": "‚óÄ –í–µ—Ä–Ω—É—Ç—å—Å—è",
"close": "üö´ –ó–∞–∫—Ä—ã—Ç—å",
"finish": "‚úÖ –ó–∞–≤–µ—Ä—à–∏—Ç—å",
"yes": "‚úî –î–∞",
"no": "‚ùå –ù–µ—Ç",
"delete": "üóë –£–¥–∞–ª–∏—Ç—å",
"nothing": "üòî –û–π, –∑–¥–µ—Å—å –Ω–∏—á–µ–≥–æ –Ω–µ—Ç("

Telegram –ë–æ—Ç —Ç—Ä–µ–±—É–µ—Ç, —á—Ç–æ–±—ã –Ω–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–∞–∂–∞–ª –Ω–∞ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å, —á—Ç–æ–±—ã –±—ã—Ç—å –ø—Ä–∏–Ω—è—Ç—ã–º –≤ –≥—Ä—É–ø–ø—É/–∫–∞–Ω–∞–ª - —ç—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ—Ö—Ä–∞–Ω—è—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –ª—é–¥–µ–π, –∫–æ—Ç–æ—Ä—ã–º –º–æ–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å —Ä–∞—Å—Å—ã–ª–∫—É –∫–æ–º–∞–Ω–¥–æ–π /send_all —Ç—É—Ç —Ç–µ–∫—Å—Ç
–ú–æ–∂–µ—Ç –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ —á–∞—Ç–µ

    –ó–∞–ø–æ–ª–Ω–∏—Ç–µ –¥–∞–Ω–Ω—ã–µ –≤ AutoAccept.py 11 - 14 —Å—Ç—Ä–æ–∫–∏
    –¢–æ–∫–µ–Ω –±–æ—Ç–∞ –≤–∑—è—Ç—å –≤ t.me/BotFather
    –ê–π–¥–∏ –≥—Ä—É–ø–ø—ã –∏ –∫–∞–Ω–∞–ª–∞ –º–æ–∂–Ω–æ –≤–∑—è—Ç—å —á–µ—Ä–µ–∑ –±–æ—Ç–∞ t.me/chatIDrobot
    –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ python —Å –æ—Ñ—Ñ. —Å–∞–π—Ç–∞ (–ø–æ—Å—Ç–∞–≤—å—Ç–µ –≥–∞–ª–æ—á–∫—É –≤ –Ω–∞—á–∞–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Add python to path)
    –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ aiogram –∫–æ–º–∞–Ω–¥–æ–π:

sudo apt install python3
pip3 install aiogram==2.22.2

–ó–∞–ø—É—Å—Ç–∏—Ç–µ –∫–æ–º–∞–Ω–¥–æ–π:
python3 AutoAccept.py

AutoAccept.py‚Äã

from aiogram import Bot, Dispatcher, executor, types
from aiogram.contrib.fsm_storage.memory import MemoryStorage
from aiogram.dispatcher import FSMContext
from aiogram.dispatcher.filters.state import State, StatesGroup
from database import Database
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton

import asyncio
import aiogram

bot = Bot(token="1234567890:AAKvIlbE5zo5_aq1yNe-0jgCmgSKfiMsdgDc", parse_mode='HTML')
admin_id = 123456789
group_id = -1201456669786
channelid = -10018166123577

storage = MemoryStorage()
dp = Dispatcher(bot, storage=storage)
db = Database()

remove_keyboard_markup = types.ReplyKeyboardRemove()

class UserConfirmation(StatesGroup):
    confirmation = State()

@dp.chat_join_request_handler()
async def start1(update: types.ChatJoinRequest):
    confirm_button = KeyboardButton('–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å')
    reply_keyboard = ReplyKeyboardMarkup(resize_keyboard=True).add(confirm_button)
    await bot.send_message(chat_id=admin_id, text=f"<b>‚ûï –ù–æ–≤–∞—è –∑–∞—è–≤–∫–∞ –≤ –∫–∞–Ω–∞–ª: </b> @{update.from_user.username} [<code>{update.from_user.id}</code>]")
    await update.bot.send_message(chat_id=update.from_user.id, text=f'<b>‚ÄºÔ∏è {update.from_user.full_name}, –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–Ω–∞–ª—É –Ω–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É <u>"–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å"</u></b>', reply_markup=reply_keyboard)
    state = dp.current_state(user=update.from_user.id)
    await state.set_state(UserConfirmation.confirmation)

@dp.message_handler(content_types=types.ContentType.TEXT, text=['–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å'])
async def confirm_user(message: types.Message, state: FSMContext):
    await bot.approve_chat_join_request(chat_id=channelid, user_id=message.from_user.id)
    usersf = db.get_user(message.from_user.id)
    if usersf is not None:
        db.add_user(message.from_user.id)
        await bot.send_message(chat_id=admin_id, text=f"<b>‚úÖ –ü—Ä–∏–Ω—è–ª–∏ –≤ –∫–∞–Ω–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</b> @{message.from_user.username} [<code>{message.from_user.id}</code>]")
        await message.answer(f'<b>‚úÖ {message.from_user.full_name} —Ç–≤–æ—è <u>–∑–∞—è–≤–∫–∞</u> –≤ –∫–∞–Ω–∞–ª –±—ã–ª–∞ <u>–ø—Ä–∏—è—Ç–∞</u>!\n\n‚òÅÔ∏è http://commudazrdyhbullltfdy222krfjhoqzizks5ejmocpft3ijtxq5khqd.onion \n\n‚ö†Ô∏è –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏ –≤ —Å–ª—É—á–∞–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, –ø—Ä–æ–ø–∏—à–∏ <u>/start</u></b>', disable_web_page_preview=True, reply_markup=remove_keyboard_markup)
        await state.finish()
    else:
        await message.answer(f'<b>‚úÖ {message.from_user.full_name} —Ç–≤–æ—è <u>–∑–∞—è–≤–∫–∞</u> –≤ –∫–∞–Ω–∞–ª –±—ã–ª–∞ <u>–ø—Ä–∏—è—Ç–∞</u>!\n\n‚òÅÔ∏è http://commudazrdyhbullltfdy222krfjhoqzizks5ejmocpft3ijtxq5khqd.onion \n\n‚ö†Ô∏è –î–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∞–∫—Ç—É–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–∏ –≤ —Å–ª—É—á–∞–∏ –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏, –ø—Ä–æ–ø–∏—à–∏ <u>/start</u></b>', disable_web_page_preview=True, reply_markup=remove_keyboard_markup)
        await bot.send_message(chat_id=admin_id, text=f"<b>‚úÖ–ü—Ä–∏–Ω—è–ª–∏ –≤ –∫–∞–Ω–∞–ª –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:</b> @{message.from_user.username} [<code>{message.from_user.id}</code>]")
        await state.finish()


@dp.message_handler(state=UserConfirmation.confirmation)
async def handle_confirmation(message: types.Message,state=FSMContext):
    print(state)
    await message.answer('<b>‚ö†Ô∏è –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∫–∞–Ω–∞–ª—É –Ω–∞–∂–º–∏ –∫–Ω–æ–ø–∫—É <u>"–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å"</u></b>')

#######################################################

@dp.message_handler(commands=['start'])
async def start(message: types.Message):
    existing_user = db.get_user(message.from_user.id)
    if existing_user is not None:
        await message.answer("üí∞")
        await message.answer("<b>–ü—Ä–∏–≤–µ—Ç, @{message.from_user.username}.\nhttp://commudazrdyhbullltfdy222krfjhoqzizks5ejmocpft3ijtxq5khqd.onion</b>", disable_web_page_preview=True, reply_markup=remove_keyboard_markup)
    else:
        await message.answer("üí∞")
        await message.answer("<b>–ü—Ä–∏–≤–µ—Ç, @{message.from_user.username}.\nhttp://commudazrdyhbullltfdy222krfjhoqzizks5ejmocpft3ijtxq5khqd.onion</b>", disable_web_page_preview=True, reply_markup=remove_keyboard_markup)
        db.add_user(message.from_user.id)

@dp.message_handler(content_types="new_chat_members")
async def on_user_join(message: types.Message):
    await message.delete()
    await bot.send_message(chat_id=admin_id, text=f'‚úÖ –ù–æ–≤—ã–π —É—á–∞—Å—Ç–Ω–∏–∫ –≤ —á–∞—Ç–µ:\n\n'
                                               f'{message.from_user.get_mention()} | {message.from_user.full_name}\n'
                                               f'Id: {message.from_user.id}\n'
                                               f'Username: @{message.from_user.username}\n'
                                               )
    new_msg = await message.answer(f'{message.from_user.get_mention()} –¥–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —á–∞—Ç!', disable_web_page_preview=True)
    await asyncio.sleep(15)
    try:
        await new_msg.delete()
    except Exception as e:
        pass

@dp.message_handler(content_types="left_chat_member")
async def on_user_join(message: types.Message):
    await message.delete()

@dp.message_handler(content_types="new_chat_title")
async def on_user_join(message: types.Message):
    await message.delete()

@dp.message_handler(content_types="new_chat_photo")
async def on_user_join(message: types.Message):
    await message.delete()

@dp.message_handler(content_types="delete_chat_photo")
async def on_user_join(message: types.Message):
    await message.delete()

@dp.message_handler(commands=['send_all'])
async def send_all_users(message: types.Message):
    if message.from_user.id == admin_id:
        users = db.get_users()
        successful_sends = 0
        failed_sends = 0
        for user in users:
            try:
                await bot.send_message(chat_id=user[0], text=message.text.replace("/send_all ", ""))
                await asyncio.sleep(0.5)
                successful_sends += 1
            except aiogram.utils.exceptions.TelegramAPIError as e:
                failed_sends += 1
        await bot.send_message(chat_id=admin_id, text=f"–†–∞—Å—Å—ã–ª–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!\n\n–£—Å–ø–µ—à–Ω–æ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–π: {successful_sends}\n–°–æ–æ–±—â–µ–Ω–∏–π —Å –æ—à–∏–±–∫–∞–º–∏: {failed_sends}")

@dp.message_handler(content_types=['photo', 'video', 'document', 'text'], chat_id=group_id)
async def handle_comment(message: types.Message):
    if message.from_user.id != 777000:
        pass
    elif message.chat.id != group_id:
        pass
    else:
        await message.reply("+", disable_web_page_preview=True)

if __name__ == '__main__':
    try:
        executor.start_polling(dp, skip_updates=True)
    finally:
        db.close()

database.py‚Äã

import sqlite3

class Database:
    def __init__(self):
        self.conn = sqlite3.connect('users.db')
        self.cursor = self.conn.cursor()
        self.cursor.execute('''CREATE TABLE IF NOT EXISTS users
                              (user_id INTEGER PRIMARY KEY)''')

    def close(self):
        self.conn.close()

    def add_user(self, user_id):
        self.cursor.execute("INSERT OR IGNORE INTO users VALUES (?)", (user_id,))
        self.conn.commit()

    def get_users(self):
        self.cursor.execute("SELECT * FROM users")
        return self.cursor.fetchall()
   
    def get_user(self, user_id):
        self.cursor.execute("SELECT * FROM users WHERE user_id = ?", (user_id,))
        return self.cursor.fetchone()

users.db –±—É–¥–µ—Ç —Ç–∞–∫–∞—è:‚Äã

BEGIN TRANSACTION;
CREATE TABLE IF NOT EXISTS "users" (
    "user_id"    INTEGER,
    PRIMARY KEY("user_id")
);
COMMIT;


